# Тестирование

## Это факты, разработчик!

1. Тесты — это не долго, не дорого. Это хороший способ экономить на средней дистанции в сколь нибудь большом и среднем проекте. Ваш проект живёт больше трёх месяцев? Вы понимаете, что вам становится сложно ментально держать его модель в голове? Из отдела QA слышны ругательства по поводу значительного увеличения времени на ручное тестирование? Значит пошли первые запахи и пора освежиться тестами!

2. Мы не избавляемся от ручного тестирования – компьютеры это всего лишь (пока что) машины. Они могут гарантировать, что конкретные узлы системы (или их совокупность) находятся в рабочем состоянии. Но то, что работа всей системы правильно отображает требования заказчика, может проверить только человек.

3. Возможно тесты вам не нужны когда:

   - Вы проверяете небольшую бизнес логику (на коленочке), которая может и не залететь в продакшен
   - Ваша девушка кричит: "Дорогой, я в стартапе"
   - Ваш кусок фронтенда является ни чем иным, как "первой дозой бесплатно", а вся фишка приложения - огромный, как мой репозиторий, API, выполняющий основную работу.

## E2E или сказка о потерянном времени

Мальчики и девочки любят E2E тесты. Все любят E2E тесты. Заполнил формочку, нажал галочку, получил результат. Однако такой вид тестов отражает максимально внешнее поведение системы, аналогично пользовательскому опыту. Разница лишь в том, что ответ приходит быстрее. И меньше разочарованных клиентов стучится к вам в поддержку. Поэтому когда ваш ответ на действия в формочке (зелёная галочка) сменится на что-то другое (зелёная какашка), вам останется пожелать удачи для установления, а что же точно сломало эту систему. Ну а бизнесу можно сразу соболезновать - ведь если сломалась, например, формочка для принятия платежей, то... уф, даже страшно представить!

Но если результаты работы E2E тестов быстрее чем пользовательский опыт - это не означает, что эти типы тестов в принципе быстрые. Средний тест, проверяющий работу простой формочки логинизации, составляет от 5 секунд (в среднем). А теперь представим, что у нас 1000 таких тестов. Интересно, как быстро вы начнёте ненавидеть девопсов, когда такие тесты, будут запускаться на каждый чих в мастер (спойлер: быстрее чем ваш кофе остынет).

А ведь чем меньше тесты запускаются, тем меньше ценности они имеют! Отсюда правило - E2E пишут только на ключевое поведение системы и кол-во такого вида тестирования в проекте должно быть как можно меньше.

## Интеграционное тестирование. Ускоряемся!

Но как же нам быть, если мы хотим понять, что происходит и почему всё пошло по пи... ну вобщем, не туда, куда следовало. На помощь спешат интеграционные тесты. Их философия понятна даже ребёнку! Пирамидка состоит из кирпичиков. Чтобы понять почему пирамидка рухнула, нужно посмотреть как связаны между собой кирпичики. Говоря по-взрослому, такой вид тестирования позволяет связать несколько узлов в небольшую систему и протестировать их взаимодействие. Если тест пройден, мы можем быть с вами уверены, что наша маленькая пирамидка работает так, как задумано. В чём же премущество по-сравнению с E2E?

Теперь мы получаем супер быстрый отклик о том, что наши узлы взаимодействуют так как нужно. Машина может прогонять эти тесты в большом количистве и уведомлять нас если что-то пошло не так в течении нескольких секунд! Победа? Ну за малым. Ведь если скажем, мы отыскали кусок пирамидки, из-за которого произошло обрушение, то как понять какой же всё-таки из кирпичиков стал непригодным? На помощь приходит unit-тестирование!

## Unit-тесты. Туда, сюда, обратно и состоянию приятно

Наконец-то мы можем осуществлять контроль качества на самом его нижнем слое! Контроль того как, из чего сделан наш кирпичик - определит стабильность нашей системы. Благодаря данному типу тестирования мы можем наблюдать за внешним поведением каждого отдельного компонента и делать заключения о качестве его реализации. Звучит круто и вкусо.

У Unit-тестов есть две важные особенности. Первая - это скорость и простота написания таких тестов! Как же приятно обмазываться шаблонами и чувствовать как растёт уверенность в твоей работе - незабываемое ощущение. А второе - покрытие. В мире тестирования существуют метрики, которые, как правило, предоставляются библиотеками. Вы воочию можете налюдать за тем как встаёт солнце, как горит огонь и как растёт количество протестированных компонентов на вашем проекте.

Но вот, в один прекрасный момент вам дарят новый конструктор, где кирпичики имеют разные отверстия непонятной формы. В попытках, вы пытаетесь собрать из них что-то стоящее, но слишком скоро приходит подруга-разочарование. Вот бы кто-нибудь дал вам инстуркцию с подробным описанием, что и в какое отверстие надо... вставить (перед попыткой пошутить на эту тему, пожалуйста, проконсультируйтесь со специалистом). И о чудо, она существует - это типизация!

## Типизация. "Гляди Пяточёк...Входит...Ой. И выходит!"

Данный инструмент позволяет нам наглядно отслеживать, что условный компонент принимает на вход и что получается на выходе. Вещи, которые идут на вход чаще всего называют пропсами (props). В различных языках програмирования для этого используются специальные сущности. Имя им интерфейсы. У нашего любимого JavaScript было тяжёлое детство, да и сам язык является динамически типизируемым. Поэтому реализацию интерфейсов не завезли. И не завезут. Зато языки, которые компилируются в JavaScript предоставляют нам такую функциональность. Самым ярким и мейнстримным из них является TypeScript. Вот как выглядит описание такого интерфейса:

```javascript

  type TWomanComponentProps = {
      knowHowToCook: boolean
  }

  // 5. Компонент
  export const WomanComponent: React.FC<TWifeComponentProps> = ({ knowHowToCook }) => {
     if(knowHowToCook) {
        return (
          <p>
            Выходи родная за меня<br>
            Буду сыт и счатслив я всегда<br>
            За твой борщ отдам я всё на свете<br>
            За котлеты, курочку, спагетти
         </p>
        )
     } else {
        return (
          <p>
            Я на тебе никогда не женюсь<br>
            Я лучше съем перед загсом свой паспорт<br>
            ...
         </p>
        )
     }
  }

```

На улице крики! Производители кирпичиков собрались на стихийный митинг и скандируют: "Зачем нам ваша типизация, когда мы можем писать unit-тесты и убеждаться в том, что пропсы соответствуют действительности". Казалось бы, правда на их стороне! Но как говорится: любой код - плохой код. Если мы можем не плодить сущности, без надобности, то так и стоит поступать (не всегда это правда - контръинтуитивные вещи иногда делают шаг вперёд - React на хуках тому доказательство)! Но в нашем случае всё строго и логично, поэтому:

```html
<p>
  Типизация нужна<br />
  Типизация важна<br />
  Каждый должен быть на своём месте!<br />
  <br />
  Написал unit-тестик на пропсы<br />
  Всё зря!<br />
  Использовал типизацию<br />
  Стало в разы прелестней!<br />
</p>
```
