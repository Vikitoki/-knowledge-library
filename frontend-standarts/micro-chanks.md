## Микрочанки

### Google page speed

Клиентов, зачастую, интересует показатели с данного сервиса. 
Это хороший инструмент, который позволяет понять, в каком месте у сайта есть проблемы. Почти.
Хорошие показатели привлекают новых клиентов.

### Основные проблемы, связанные с Google page speed

1. Неиспользуемый код. Например, если код и стили для компонента присутствуют в файле, но самого компонента на странице нет. 
При накоплении таких моментов в коде происходит колоссальное снижение показателей.

2. Прыгающие стили или стили загружающиеся рывками. Часто при плохой оптимизации, разделении файлов при загрузке страницы вы можете успеть увидеть нестилизованный сайт,
увидеть HTML, в котором отсутствуют стили. Через определённое время спустя они появляются на странице
и происходят очень сильные рывки, которые влияют на то, что видит пользователь. К счастью в современном фронтенде существуют подходы
и целые технологии направленные на решение данной проблемы. Примеры таких подходов:

    - **“Critical”.** Подход, при котором, в css файлы, являющиеся критическими для страницы, подключаются в [первую очередь](https://doka.guide/css/adding-styles/#vstroennye-stili).

    - “Preload chunks“. <link rel=”preload” href=”…” as=”style” /> Таковой подход значительно снизит нагрузку на бэкенд,
    в том плане, что им не прийдется обрабатывать двойное
    существование одних и тех же страниц,
    с разницей в наличии инлайновых стилей, с обрабуткой кук, что уже есть, а что нет. По сути NextJS так и делает, там нету прям космической магии.

TODO: поискать такие решения и скинуть ссылки на них

### Web Vitals

Немного терминологии:

**TTFB.** Time To First Byte - время от момента запроса, до первого полученного байта.
Зависит от хостинга, CDN и состояния кеширования. Как правило, не является задачей UI. Улучшить этот показатель очень не просто.
Однако, нужно знать о месте хранения ассетов проекта (картинки, шрифты, иконки и т.д). Если 
CDN отдают файлы быстрее чем хостинг, то следует вынести данные файлы именно туда.

**FCP.** First Contentful Paint - время первого кадра, который заполнит весь вьюпорт. 
Момент, когда пользователь увидит хоть что-то. Зависит от размера и способа подключения css стилей.

**LCP.** Largest Contentful Paint - время до появления самого крупного элемента на странице, например картинки. 
Зависит от размера js файлов, скорости работы парсера движка браузера.

**TBT.** Total Blocking Time - время, в течении которого, пользователь 
не может взаимодействовать со страницей. Чаще всего, данный показатель определяется временем загрузки js файлов и загрузкой html 
документа, после парсинга.

**CLS.** Cumulative Layout Shift - время, фиксируемое во время последнего изменения контента страницы, при котором
меняется высота вьюпорта.

**FID.** First Input Delay - время, указывающее на то, как скоро пользователь сможет взаимодействовать со страницей (например скролить).
Зависит от размера стилей и js.


### Инструменты для исследования

- yarn dev:anlz

TODO: подумать, нужен ли этот раздел


### Почему размер бандла так важен?

TODO: подумать, нужен ли этот раздел

На первый взгляд, кажется, что условные 1.5мб js не так уж и много,
да на любой странице картинка может оказаться больше чем бандл, а ведь картинок много. 
Но загвоздка в том, что js это не просто статичные данные, как картинка, 
это нагрузка на память и процессор устройства. 
Да, на компе проблем может не наблюдаться, но вот на мобилке все убдет очень плохо.
Мобилки априори слабее компов, у них ниже скорость подключения к интернетику.
Медленно приехавшая лэзи лоад картинка, не заблокирует пользователя при оформлении заказа,
и если не приедет вовсе, то не сломает сайт. Картинке, после того как приехала, останется всего лишь прогрузиться. 
А вот js бандл должен еще отработать, отработать в правильном порядке, записать в память все необходимые переменные и т.д.

И поэтому, чем меньше бандл, тем меньше устройству нужно будет выполнить операций.
